# Implementation Plan

- [x] 1. Set up dependencies and project structure
  - [x] 1.1 Install Vercel AI SDK and dependencies
    - Install `@ai-sdk/react` and `ai` packages
    - Install `swr` for data fetching
    - Install `fast-deep-equal` for memo comparison
    - _Requirements: 1.1, 2.3_
  - [x] 1.2 Create directory structure and type definitions
    - Create `features/chat/` directory with components, hooks, types subdirectories
    - Create `lib/ai/` directory for AI configurations
    - Define TypeScript interfaces in `features/chat/types.ts`
    - _Requirements: 1.1, 2.2, 3.1_
  - [x] 1.3 Create AI Elements components for chat UI
    - Create `components/ai-elements/message.tsx` - Message display component
    - Create `components/ai-elements/prompt-input.tsx` - Input with textarea and toolbar
    - Create `components/ai-elements/loader.tsx` - Loading/thinking indicator
    - Create `components/ai-elements/conversation.tsx` - Messages container
    - _Requirements: 3.2, 3.3, 5.1_
  - [ ]\* 1.4 Write property test for unique ID generation
    - **Property 1: Unique ID Generation**
    - **Validates: Requirements 1.1**

- [x] 2. Implement utility functions and AI configuration
  - [x] 2.1 Create generateUUID utility function
    - Implement UUID v4 generation in `lib/utils.ts`
    - Export function for use across chat components
    - _Requirements: 1.1_
  - [x] 2.2 Create AI model configuration
    - Create `lib/ai/models.ts` with DEFAULT_CHAT_MODEL constant
    - Define available chat models array
    - _Requirements: 1.3, 4.4_

- [x] 3. Implement Message component using AI Elements
  - [x] 3.1 Create chat Message wrapper component
    - Create `features/chat/components/message.tsx`
    - Use AI Elements Message component as base
    - Implement user message styling (right-aligned, blue background)
    - Implement assistant message styling (left-aligned, with icon)
    - Support streaming content display
    - _Requirements: 3.2, 3.3, 5.2_
  - [x] 3.2 Create ThinkingMessage component
    - Use AI Elements Loader component
    - Create loading indicator for "submitted" status
    - Animate thinking dots or spinner
    - _Requirements: 5.1, 5.3_

- [x] 4. Implement Messages component
  - [x] 4.1 Create Messages component with scroll management
    - Create `features/chat/components/messages.tsx`
    - Use AI Elements Conversation component as container
    - Implement message list rendering with map
    - Add auto-scroll to bottom on new messages
    - Add "scroll to bottom" button when scrolled up
    - _Requirements: 3.1, 3.4, 3.5, 4.2_
  - [x] 4.2 Create useMessages hook
    - Create `features/chat/hooks/use-messages.ts`
    - Implement scroll position tracking
    - Implement isAtBottom state
    - Implement scrollToBottom function
    - _Requirements: 3.4, 3.5_
  - [ ]\* 4.3 Write property test for message rendering completeness
    - **Property 4: Message Rendering Completeness**
    - **Validates: Requirements 3.1, 4.2**

- [x] 5. Implement ChatInput component using AI Elements
  - [x] 5.1 Create ChatInput component
    - Create `features/chat/components/chat-input.tsx`
    - Use AI Elements PromptInput component as base
    - Implement textarea with controlled input
    - Add submit button with send icon
    - Add stop button (visible during streaming)
    - Implement keyboard shortcuts (Enter to submit)
    - _Requirements: 2.1, 2.3, 5.4, 6.1_
  - [ ]\* 5.2 Write property test for empty message validation
    - **Property 3: Empty Message Validation**
    - **Validates: Requirements 2.5**

- [x] 6. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 7. Implement Chat component (main)
  - [x] 7.1 Create Chat component with useChat hook
    - Create `features/chat/components/chat.tsx`
    - Integrate useChat hook from @ai-sdk/react
    - Compose Messages and ChatInput components
    - Handle submit, stop, and regenerate actions
    - Implement sticky input at bottom
    - _Requirements: 1.2, 2.2, 2.3, 2.4, 6.2, 8.1, 8.3_
  - [ ]\* 7.2 Write property test for message submission
    - **Property 2: Message Submission Adds to List**
    - **Validates: Requirements 2.2**
  - [ ]\* 7.3 Write property test for partial response preservation
    - **Property 6: Partial Response Preservation**
    - **Validates: Requirements 6.3**

- [x] 8. Implement DataStreamHandler
  - [x] 8.1 Create DataStreamHandler component
    - Create `features/chat/components/data-stream-handler.tsx`
    - Create DataStreamProvider context
    - Handle streaming data from AI response
    - _Requirements: 2.4, 5.2_

- [x] 9. Implement chat pages
  - [x] 9.1 Create new chat page
    - Create `app/(chat)/page.tsx`
    - Generate unique chat ID on page load
    - Initialize Chat component with empty messages
    - Set default model and private visibility
    - _Requirements: 1.1, 1.2, 1.3, 1.4_
  - [x] 9.2 Create existing chat page
    - Create `app/(chat)/chat/[id]/page.tsx`
    - Fetch chat data by ID
    - Handle not found case
    - Load and display previous messages
    - Implement authorization check
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_
  - [ ]\* 9.3 Write property test for authorization access control
    - **Property 5: Authorization Access Control**
    - **Validates: Requirements 4.5**
  - [x] 9.4 Create chat layout
    - Create `app/(chat)/layout.tsx`
    - Wrap children with DataStreamProvider
    - Apply responsive container styles
    - _Requirements: 8.1, 8.2_

- [x] 10. Implement error handling
  - [x] 10.1 Add error handling to Chat component
    - Handle API errors with toast notifications
    - Handle network errors with retry option
    - Handle session expiration with redirect
    - _Requirements: 7.1, 7.2, 7.3_

- [x] 11. Create public exports
  - [x] 11.1 Create index files for exports
    - Create `features/chat/components/index.ts`
    - Create `features/chat/hooks/index.ts`
    - Create `features/chat/index.ts`
    - _Requirements: All_

- [x] 12. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
